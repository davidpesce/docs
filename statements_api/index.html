<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Learning Locker Documentation</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Documentation for Learning Locker, the open source learning record store.">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/tomorrow-night.css">
    <link rel="stylesheet" href="../css/docs.css">

    <script async="" src="//www.google-analytics.com/analytics.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-941797-7', 'learninglocker.net');
        ga('send', 'pageview');

    </script>
    <script type="text/javascript">
        function prettyCode() {
            var tables = document.getElementsByTagName('table');
            for (index = 0; index < tables.length; ++index) {
                tables[index].className = "table table-default table-bordered";
            }
        }
    </script>
</head>


    <body onload="prettyCode();">

    <div class="docs-masthead">
    <div class="container">
        <img src="../images/logo-small.png" class="logo">
        <nav class="docs-nav pull-right">
            <a class="docs-nav-item" href="http://learninglocker.net">Website</a>
            <a class="docs-nav-item" href="https://github.com/learninglocker">Github</a>
            <a class="docs-nav-item" href="https://github.com/learninglocker/docs">Edit</a>
        </nav>
    </div>
</div>


    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-3 docs-sidebar">
                <div class="sidebar-title">
                    <a href="../welcome">Getting Started</a>
                </div>
                <ul class="nav">
                    <li><a href="../installation">Installing</a></li>
                    <li><a href="../troubleshooting">Troubleshooting</a></li>
                    <li><a href="../upgrading">Upgrading</a></li>
                    <li><a href="../contribute">Contributing</a></li>
                    <li><a href="../contributors">Contributors</a></li>
                </ul>
                <div class="sidebar-title">
                    <a href="#">User Interfaces</a>
                </div>
                <ul class="nav">
                    <li><a href="../administration">Administration</a></li>
                    <li><a href="../reporting">Reports</a></li>
                    <li><a href="../exporting">Exports</a></li>
                </ul>
                <div class="sidebar-title">
                    <a href="../postman">HTTP Interfaces (APIs)</a>
                </div>
                <ul class="nav">
                    <li><a href="../analytics_api">Analytics</a></li>
                    <li><a href="../statements_api">Aggregation</a></li>
                    <li><a href="../report_api">Reports</a></li>
                    <li><a href="../exports_api">Exports</a></li>
                </ul>
            </div>
            <div class="col-xs-12 col-sm-8 docs-main">
                <h1 id="statements-aggregation-api">Statements (Aggregation) API</h1>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>HTTP request</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="#where">where</a></td>
      <td>GET /where</td>
      <td><strong>Deprecated.</strong> Gets a paginated list of statements that match given filters.</td>
    </tr>
    <tr>
      <td><a href="#aggregate">aggregate</a></td>
      <td>GET /aggregate</td>
      <td>Runs an aggregation of the statements using a pipeline.</td>
    </tr>
    <tr>
      <td><a href="#aggregatetime">aggregateTime</a></td>
      <td>GET /aggregate/time</td>
      <td><strong>Deprecated.</strong> Runs a time based aggregation of the statements using a match.</td>
    </tr>
    <tr>
      <td><a href="#aggregateobject">aggregateObject</a></td>
      <td>GET /aggregate/object</td>
      <td><strong>Deprecated.</strong> Runs a object based aggregation of the statements using a match.</td>
    </tr>
    <tr>
      <td><a href="#void">void</a></td>
      <td>GET http://www.example.com /api/v2/statements/void</td>
      <td>Voids statements using a given match.</td>
    </tr>
    <tr>
      <td><a href="#insert">insert</a></td>
      <td>GET http://www.example.com /api/v2/statements/insert</td>
      <td>Inserts new statements from the result of running an aggregation of the existing statements using a pipeline.</td>
    </tr>
  </tbody>
</table>

<p><em>URIs relative to http://www.example.com/api/v1/statements/, unless otherwise noted. Additionally you must supply your Basic Auth details with each request. Your Basic Auth details can be found under “Manage clients” in your LRS’s settings.</em></p>

<p><strong>Be aware of <a href="../installation/#quirks">keys with dots</a> and the <a href="#structure-of-statements">structure of statements in Learning Locker</a>.</strong></p>

<h2 id="where">where</h2>
<p><strong>Deprecated</strong> - use <a href="#aggregate">aggregate</a> instead.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/where
</code></pre>
</div>

<h3 id="parameters">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>filters</strong></td>
      <td>Array of FilterArrays</td>
      <td>The filters that the statements must pass.</td>
    </tr>
    <tr>
      <td>limit</td>
      <td>Integer</td>
      <td>The number of statements to be returned (defaults to 100).</td>
    </tr>
    <tr>
      <td>page</td>
      <td>Integer</td>
      <td>The page to be returned (defaults to 1).</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>.</em></p>

<h3 id="example">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/where?limit=10&amp;page=1&amp;filter=[
  ["statement.verb.id", "in", ["verb/1", "verb/2"],
  ["statement.timestamp", "between", "2015-01-01", "2015-01-15"],
  ["statement.actor.mbox", "=", "mailto:ex@mple.com"]
]
</code></pre>
</div>

<h2 id="aggregate">aggregate</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate
</code></pre>
</div>

<h3 id="parameters-1">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>pipeline</strong></td>
      <td><a href="http://docs.mongodb.org/manual/core/aggregation-pipeline/">MongoAggregationPipeline</a></td>
      <td>The pipeline to pass  statements through.</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>. Note that this endpoint will return voided statements unless specified in your pipeline (see example below).</em></p>

<h3 id="example-1">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate?pipeline=[{
  "$match": {
    "statement.timestamp": {
      "$gt":"2015-01-01T00:00",
      "$lt":"2015-01-02T00:00"
    },
    "statement.actor.mbox": "mailto:ex@mple.com",
    "voided": false
  }
}, {
  "$project": {
    "_id": 0,
    "statement": 1
  }
}]
</code></pre>
</div>

<h2 id="aggregatetime">aggregateTime</h2>
<p><strong>Deprecated</strong> - use <a href="#aggregate">aggregate</a> instead.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate/time
</code></pre>
</div>

<h3 id="parameters-2">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>match</strong></td>
      <td><a href="http://docs.mongodb.org/manual/reference/operator/aggregation/match/">MongoAggregationMatch</a></td>
      <td>The match to pass statements through.</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>. Note that this endpoint will return voided statements unless specified in your pipeline (see example below).</em></p>

<h3 id="example-2">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate/time?match={
  "statement.timestamp": {
    "$gt":"2015-01-01T00:00",
    "$lt":"2015-01-02T00:00"
  },
  "statement.actor.mbox": "mailto:ex@mple.com",
  "voided": false
}
</code></pre>
</div>

<h2 id="aggregateobject">aggregateObject</h2>
<p><strong>Deprecated</strong> - use <a href="#aggregate">aggregate</a> instead.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate/object
</code></pre>
</div>

<h3 id="parameters-3">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>match</strong></td>
      <td><a href="http://docs.mongodb.org/manual/reference/operator/aggregation/match/">MongoAggregationMatch</a></td>
      <td>The match to pass statements through.</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>. Note that this endpoint will return voided statements unless specified in your pipeline (see example below).</em></p>

<h3 id="example-3">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v1/statements/aggregate/object?match={
  "statement.timestamp": {
    "$gt":"2015-01-01T00:00",
    "$lt":"2015-01-02T00:00"
  },
  "statement.actor.mbox": "mailto:ex@mple.com",
  "voided": false
}
</code></pre>
</div>

<h2 id="void">void</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v2/statements/void
</code></pre>
</div>

<h3 id="parameters-4">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>match</strong></td>
      <td><a href="http://docs.mongodb.org/manual/reference/operator/aggregation/match/">MongoAggregationMatch</a></td>
      <td>The match to pass statements through.</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>. This should be used with <strong>extreme caution</strong> and we recommend using the <a href="#aggregate">aggregate method</a> first to check which <strong>statements will be removed</strong>.</em></p>

<h3 id="example-4">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v2/statements/void?match={
  "statement.timestamp": {
    "$gt":"2015-01-01T00:00",
    "$lt":"2015-01-02T00:00"
  },
  "statement.actor.mbox": "mailto:ex@mple.com"
}
</code></pre>
</div>

<h2 id="insert">insert</h2>
<p>This method attempts to insert whatever data is projected from the given <a href="http://docs.mongodb.org/manual/core/aggregation-pipeline/">MongoAggregationPipeline</a> as statements.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v2/statements/insert
</code></pre>
</div>

<h3 id="parameters-5">Parameters</h3>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>pipeline</strong></td>
      <td><a href="http://docs.mongodb.org/manual/core/aggregation-pipeline/">MongoAggregationPipeline</a></td>
      <td>The pipeline to pass statements through.</td>
    </tr>
  </tbody>
</table>

<p><em>Required parameters are shown in <strong>bold</strong>.  Note that this endpoint will match voided statements unless specified in your pipeline (see example below).</em></p>

<h3 id="example-5">Example</h3>
<p>This example will void all of the statements in an LRS. You could create similar queries to award badges based on a match.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GET http://www.example.com/api/v2/statements/insert?pipeline=[{
  "$match": {
    "statement.verb.id": {"$ne": "http://adlnet.gov/expapi/verbs/voided"},
    "voided": false
  }
}, {
  "$project": {
    "_id": 0,
    "actor": {"$literal": {
      "name": "Darth Voider",
      "mbox": "mailto:darth@voider.com"
    }},
    "verb": {
      "id": {"$literal": "http://adlnet.gov/expapi/verbs/voided"},
      "display": {
        "en": {"$literal": "voided"}
      }
    },
    "object": {
      "objectType": {"$literal": "StatementRef"},
      "id": "$statement.id"
    }
  }
}]
</code></pre>
</div>

<h1 id="structure-of-statements">Structure of Statements</h1>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>_id</td>
      <td><a href="http://php.net/manual/en/class.mongoid.php">MongoId</a></td>
      <td>Unique identifer in the database (not the LRS).</td>
    </tr>
    <tr>
      <td>lrs_id</td>
      <td><a href="http://php.net/manual/en/class.mongoid.php">MongoId</a></td>
      <td>The identifier associated with the LRS.</td>
    </tr>
    <tr>
      <td>client_id</td>
      <td><a href="http://php.net/manual/en/class.mongoid.php">MongoId</a></td>
      <td>The identifier associated with the Learning Locker Client that created the statement.</td>
    </tr>
    <tr>
      <td>statement</td>
      <td><a href="https://github.com/adlnet/xAPI-Spec/blob/master/xAPI.md#stmtprops">xAPI Statement</a></td>
      <td>The raw xAPI Statement in JSON.</td>
    </tr>
    <tr>
      <td>active</td>
      <td>Boolean</td>
      <td>Determines if the statement was successfully stored and can be retrieved.</td>
    </tr>
    <tr>
      <td>voided</td>
      <td>Boolean</td>
      <td>Determines if the statement has been voided.</td>
    </tr>
    <tr>
      <td>timestamp</td>
      <td><a href="https://docs.mongodb.org/manual/core/shell-types/">ISODate</a></td>
      <td>A ISODate copy of <code class="highlighter-rouge">statement.timestamp</code> (better performance).</td>
    </tr>
    <tr>
      <td>stored</td>
      <td><a href="https://docs.mongodb.org/manual/core/shell-types/">ISODate</a></td>
      <td>A ISODate copy of <code class="highlighter-rouge">statement.stored</code> (better performance).</td>
    </tr>
    <tr>
      <td>refs</td>
      <td>Array&lt;<a href="https://github.com/adlnet/xAPI-Spec/blob/master/xAPI.md#stmtprops">xAPI Statement</a>&gt;</td>
      <td>An array of raw xAPI statements that are referred to by the current statement.</td>
    </tr>
  </tbody>
</table>

            </div>
        </div>
    </div>

    <footer class="docs-footer">
    <p>Learning Locker and the Squirrel logo are copyright HT2, 2014 | Learning Locker is licensed under GPL 3.0.</p>
    <p>
        <a href="#">Back to top</a>
    </p>
</footer>


    </body>
</html>
